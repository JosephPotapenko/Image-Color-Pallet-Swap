<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Palette Editor â€” 25 Palettes Ã— 50 Variations</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- README Button -->
  <a href="readme.html" id="readmeBtn" class="readme-btn" title="View Documentation">
    ğŸ“– README
  </a>
  
  <div class="app">
    <div id="left">
      <div class="header-row">
        <h2>Upload Image</h2>
        <button id="themeToggle" class="theme-toggle-btn" title="Toggle Light/Dark Mode">
          ğŸŒ™
        </button>
      </div>
      <input id="fileInput" type="file" accept="image/*">
      <div id="imageControls" style="margin-top:10px; display:none;">
        <button id="saveImagePalette" class="btn primary" title="Save the extracted colors from this image as a new palette (Ctrl+I)">
          ğŸ’¾ Save Image Palette
        </button>
        <button id="replaceWithPalette" class="btn success" title="Replace image colors with closest matches from the active palette (Ctrl+R)" style="margin-left: 8px;">
          ğŸ¨ Replace with Palette
        </button>
        <div style="margin-top: 8px;">
          <button id="undoColors" class="btn" title="Undo last 10 color changes (Ctrl+Z)" style="margin-right: 8px;">
            â†¶ Undo
          </button>
          <button id="redoColors" class="btn" title="Redo next 10 color changes (Ctrl+Y)">
            â†· Redo
          </button>
        </div>
        <div style="margin-top: 8px; font-size: 12px;">
          <label style="color: #ccc; cursor: pointer; display: flex; align-items: center; gap: 6px;">
            <input type="checkbox" id="confirmSwaps" checked style="margin: 0;">
            <span>Confirm palette swaps</span>
          </label>
        </div>
      </div>
      <div class="canvas-container" style="margin-top:10px;">
        <div class="canvas-wrapper">
          <div class="canvas-viewport" id="canvasViewport">
            <canvas id="canvas"></canvas>
          </div>
        </div>
      </div>
      
      <!-- Image Adjustment Controls -->
      <div class="image-adjustments" style="margin-top: 15px; background: var(--panel); padding: 12px; border-radius: 8px; border: 1px solid #333;">
        <h3 style="margin: 0 0 12px 0; font-size: 14px; color: #ccc; text-align: center;">Image Adjustments</h3>
        
        <div class="adjustment-controls" style="display: flex; flex-direction: column; gap: 12px;">
          <!-- Brightness -->
          <div class="adjustment-control">
            <label style="display: block; font-size: 12px; color: #aaa; margin-bottom: 6px;">
              â˜€ï¸ Brightness: <span id="brightnessValue">0</span>
            </label>
            <div style="display: flex; align-items: center; gap: 8px;">
              <button class="adjustment-btn" id="brightnessDown" style="background: #4CAF50; border: none; color: white; width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 12px;">âˆ’</button>
              <input type="range" id="brightnessSlider" min="-100" max="100" value="0" 
                     style="flex: 1; accent-color: #4CAF50;">
              <button class="adjustment-btn" id="brightnessUp" style="background: #4CAF50; border: none; color: white; width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 12px;">+</button>
            </div>
          </div>
          
          <!-- Saturation -->
          <div class="adjustment-control">
            <label style="display: block; font-size: 12px; color: #aaa; margin-bottom: 6px;">
              ğŸ¨ Saturation: <span id="saturationValue">0</span>
            </label>
            <div style="display: flex; align-items: center; gap: 8px;">
              <button class="adjustment-btn" id="saturationDown" style="background: #FF9800; border: none; color: white; width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 12px;">âˆ’</button>
              <input type="range" id="saturationSlider" min="-100" max="100" value="0" 
                     style="flex: 1; accent-color: #FF9800;">
              <button class="adjustment-btn" id="saturationUp" style="background: #FF9800; border: none; color: white; width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 12px;">+</button>
            </div>
          </div>
          
          <!-- Color Pop -->
          <div class="adjustment-control">
            <label style="display: block; font-size: 12px; color: #aaa; margin-bottom: 6px;">
              ğŸ’¥ Color Pop: <span id="colorPopValue">0</span>
            </label>
            <div style="display: flex; align-items: center; gap: 8px;">
              <button class="adjustment-btn" id="colorPopDown" style="background: #E91E63; border: none; color: white; width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 12px;">âˆ’</button>
              <input type="range" id="colorPopSlider" min="0" max="100" value="0" 
                     style="flex: 1; accent-color: #E91E63;">
              <button class="adjustment-btn" id="colorPopUp" style="background: #E91E63; border: none; color: white; width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 12px;">+</button>
            </div>
          </div>
          
          <!-- Shadow -->
          <div class="adjustment-control">
            <label style="display: block; font-size: 12px; color: #aaa; margin-bottom: 6px;">
              ğŸŒ‘ Shadow: <span id="shadowValue">0</span>
            </label>
            <div style="display: flex; align-items: center; gap: 8px;">
              <button class="adjustment-btn" id="shadowDown" style="background: #9C27B0; border: none; color: white; width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 12px;">âˆ’</button>
              <input type="range" id="shadowSlider" min="-100" max="100" value="0" 
                     style="flex: 1; accent-color: #9C27B0;">
              <button class="adjustment-btn" id="shadowUp" style="background: #9C27B0; border: none; color: white; width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 12px;">+</button>
            </div>
          </div>
        </div>
        
        <!-- Control Buttons -->
        <div style="display: flex; gap: 8px; justify-content: center; margin-top: 12px;">
          <button id="resetAdjustments" class="btn" style="font-size: 12px; padding: 6px 12px;">
            ğŸ”„ Reset All
          </button>
          <button id="centerImage" class="btn" style="font-size: 12px; padding: 6px 12px;">
            ğŸ¯ Center
          </button>
          <button id="downloadImage" class="btn primary" style="font-size: 12px; padding: 6px 12px;">
            ğŸ’¾ Download
          </button>
        </div>
      </div>
    </div>

    <div id="middle">
      <div style="display:flex;align-items:center;justify-content:space-between;">
        <h2>Extracted Palette</h2>
        <div class="small">Four columns â€¢ Click to highlight â€¢ Double-click to edit</div>
      </div>
      
      <!-- Color Merge Control -->
      <div class="color-merge-control" style="background: var(--panel); padding: 10px; border-radius: 6px; border: 1px solid #333; margin-bottom: 12px;">
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
          <label style="font-size: 12px; color: #aaa; font-weight: 600;">
            ğŸ”— Merge Similar Colors: <span id="mergeThresholdValue">5</span>%
          </label>
          <div style="display: flex; gap: 4px;">
            <button id="undoMerge" class="btn" style="font-size: 10px; padding: 3px 6px; background: #ff8888; opacity: 0.5;" disabled title="Undo last merge">
              â†¶ Undo
            </button>
            <button id="redoMerge" class="btn" style="font-size: 10px; padding: 3px 6px; background: #61d6d6; opacity: 0.5;" disabled title="Redo last undone merge">
              â†· Redo
            </button>
            <button id="applyMerge" class="btn" style="font-size: 11px; padding: 4px 8px;">
              Apply Merge
            </button>
          </div>
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
          <button class="adjustment-btn" id="mergeThresholdDown" style="background: #2196F3; border: none; color: white; width: 20px; height: 20px; border-radius: 3px; cursor: pointer; font-size: 10px;">âˆ’</button>
          <input type="range" id="mergeThresholdSlider" min="1" max="80" value="5" 
                 style="flex: 1; accent-color: #2196F3;">
          <button class="adjustment-btn" id="mergeThresholdUp" style="background: #2196F3; border: none; color: white; width: 20px; height: 20px; border-radius: 3px; cursor: pointer; font-size: 10px;">+</button>
        </div>
        <div style="font-size: 10px; color: #888; margin-top: 4px;">
          Lower values = more aggressive merging â€¢ Higher values = preserve more distinct colors
        </div>
      </div>
      
      <div style="font-size: 10px; color: #aaa; margin-bottom: 8px; padding: 4px; background: rgba(33, 150, 243, 0.1); border-left: 3px solid #2196F3; border-radius: 3px;">
        ğŸ’¡ <strong>Tip:</strong> Drag and drop colors to reorder your palette
      </div>
      
      <div class="color-list" id="colorList"></div>
    </div>

    <div id="right">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div>
          <div style="font-weight:600;">Palettes (<span id="paletteCount">25</span>)</div>
          <div class="small">Preview first 10 swatches on tab</div>
        </div>
        <div>
          <button id="toggleRecolor" class="btn">Toggle Recolor: ON</button>
        </div>
      </div>

      <div class="custom-palette-controls">
        <input type="text" class="custom-palette-name" placeholder="Enter palette name..." id="customPaletteName">
        <div class="custom-palette-actions">
          <button id="saveCurrentPalette" class="btn success" title="Save the currently viewed palette with the entered name">Save Current</button>
          <button id="createFromExtracted" class="btn primary" title="Create a new palette from the extracted image colors">From Extracted</button>
          <button id="createEmpty" class="btn" title="Create a new empty palette with 75 white colors">Create Empty</button>
          <button id="importPalette" class="btn" title="Import palettes from a JSON file">Import</button>
          <button id="exportPalettes" class="btn" title="Export all custom palettes to a JSON file (Ctrl+E)">Export All</button>
        </div>
        <div class="small" style="margin-top: 4px;">
          ğŸ’¡ Tip: Double-click custom palette colors to edit â€¢ Ctrl+S to save â€¢ Ctrl+I to save image palette â€¢ Ctrl+R to replace with palette â€¢ Ctrl+Z/Y to undo/redo
        </div>
      </div>

      <div class="tabs" id="tabButtons"></div>
      <div id="tabLabel" style="font-size:13px;font-weight:600;margin-top:6px;"></div>
      <div class="palette-grid" id="tabContent"></div>
    </div>
  </div>
  <script src="script.js"></script>
</body>
</html>
